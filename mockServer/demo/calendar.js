const data = [{
    "id": 1,
    "year": "2023",
    "months": {
        "1": {
            "available": false,
            "dates": {
                "1672502400000": {
                    "available": false,
                    "spaces": 0
                },
                "1672588800000": {
                    "available": false,
                    "spaces": 0
                },
                "1672675200000": {
                    "available": false,
                    "spaces": 0
                },
                "1672761600000": {
                    "available": false,
                    "spaces": 0
                },
                "1672848000000": {
                    "available": false,
                    "spaces": 0
                },
                "1672934400000": {
                    "available": false,
                    "spaces": 0
                },
                "1673020800000": {
                    "available": false,
                    "spaces": 0
                },
                "1673107200000": {
                    "available": false,
                    "spaces": 0
                },
                "1673193600000": {
                    "available": false,
                    "spaces": 0
                },
                "1673280000000": {
                    "available": false,
                    "spaces": 0
                },
                "1673366400000": {
                    "available": false,
                    "spaces": 0
                },
                "1673452800000": {
                    "available": false,
                    "spaces": 0
                },
                "1673539200000": {
                    "available": false,
                    "spaces": 0
                },
                "1673625600000": {
                    "available": false,
                    "spaces": 0
                },
                "1673712000000": {
                    "available": false,
                    "spaces": 0
                },
                "1673798400000": {
                    "available": false,
                    "spaces": 0
                },
                "1673884800000": {
                    "available": false,
                    "spaces": 0
                },
                "1673971200000": {
                    "available": false,
                    "spaces": 0
                },
                "1674057600000": {
                    "available": false,
                    "spaces": 0
                },
                "1674144000000": {
                    "available": false,
                    "spaces": 0
                },
                "1674230400000": {
                    "available": false,
                    "spaces": 0
                },
                "1674316800000": {
                    "available": false,
                    "spaces": 0
                },
                "1674403200000": {
                    "available": false,
                    "spaces": 0
                },
                "1674489600000": {
                    "available": false,
                    "spaces": 0
                },
                "1674576000000": {
                    "available": false,
                    "spaces": 0
                },
                "1674662400000": {
                    "available": false,
                    "spaces": 0
                },
                "1674748800000": {
                    "available": false,
                    "spaces": 0
                },
                "1674835200000": {
                    "available": false,
                    "spaces": 0
                },
                "1674921600000": {
                    "available": false,
                    "spaces": 0
                },
                "1675008000000": {
                    "available": false,
                    "spaces": 0
                },
                "1675094400000": {
                    "available": false,
                    "spaces": 0
                },
            }
        },
        "2": {
            "available": false,
            "dates": {
                "1675180800000": {
                    "available": false,
                    "spaces": 0
                },
                "1675267200000": {
                    "available": false,
                    "spaces": 0
                },
                "1675353600000": {
                    "available": false,
                    "spaces": 0
                },
                "1675440000000": {
                    "available": false,
                    "spaces": 0
                },
                "1675526400000": {
                    "available": false,
                    "spaces": 0
                },
                "1675612800000": {
                    "available": false,
                    "spaces": 0
                },
                "1675699200000": {
                    "available": false,
                    "spaces": 0
                },
                "1675785600000": {
                    "available": false,
                    "spaces": 0
                },
                "1675872000000": {
                    "available": false,
                    "spaces": 0
                },
                "1675958400000": {
                    "available": false,
                    "spaces": 0
                },
                "1676044800000": {
                    "available": false,
                    "spaces": 0
                },
                "1676131200000": {
                    "available": false,
                    "spaces": 0
                },
                "1676217600000": {
                    "available": false,
                    "spaces": 0
                },
                "1676304000000": {
                    "available": false,
                    "spaces": 0
                },
                "1676390400000": {
                    "available": false,
                    "spaces": 0
                },
                "1676476800000": {
                    "available": false,
                    "spaces": 0
                },
                "1676563200000": {
                    "available": false,
                    "spaces": 0
                },
                "1676649600000": {
                    "available": false,
                    "spaces": 0
                },
                "1676736000000": {
                    "available": false,
                    "spaces": 0
                },
                "1676822400000": {
                    "available": false,
                    "spaces": 0
                },
                "1676908800000": {
                    "available": false,
                    "spaces": 0
                },
                "1676995200000": {
                    "available": false,
                    "spaces": 0
                },
                "1677081600000": {
                    "available": false,
                    "spaces": 0
                },
                "1677168000000": {
                    "available": false,
                    "spaces": 0
                },
                "1677254400000": {
                    "available": false,
                    "spaces": 0
                },
                "1677340800000": {
                    "available": false,
                    "spaces": 0
                },
                "1677427200000": {
                    "available": false,
                    "spaces": 0
                },
                "1677513600000": {
                    "available": false,
                    "spaces": 0
                }
            }
        },
        "3": {
            "available": true,
            "dates": {
                "1677600000000": {
                    "available": false,
                    "spaces": 0
                },
                "1677686400000": {
                    "available": false,
                    "spaces": 0
                },
                "1677772800000": {
                    "available": true,
                    "spaces": 5
                },
                "1677859200000": {
                    "available": true,
                    "spaces": 5
                },
                "1677945600000": {
                    "available": true,
                    "spaces": 5
                },
                "1678032000000": {
                    "available": true,
                    "spaces": 5
                },
                "1678118400000": {
                    "available": true,
                    "spaces": 0
                },
                "1678204800000": {
                    "available": true,
                    "spaces": 5
                },
                "1678291200000": {
                    "available": true,
                    "spaces": 5
                },
                "1678377600000": {
                    "available": true,
                    "spaces": 5
                },
                "1678464000000": {
                    "available": true,
                    "spaces": 0
                },
                "1678550400000": {
                    "available": true,
                    "spaces": 5
                },
                "1678636800000": {
                    "available": true,
                    "spaces": 5
                },
                "1678723200000": {
                    "available": true,
                    "spaces": 5
                },
                "1678809600000": {
                    "available": true,
                    "spaces": 5
                },
                "1678896000000": {
                    "available": true,
                    "spaces": 5
                },
                "1678982400000": {
                    "available": true,
                    "spaces": 5
                },
                "1679068800000": {
                    "available": true,
                    "spaces": 5
                },
                "1679155200000": {
                    "available": true,
                    "spaces": 5
                },
                "1679241600000": {
                    "available": true,
                    "spaces": 5
                },
                "1679328000000": {
                    "available": true,
                    "spaces": 5
                },
                "1679414400000": {
                    "available": true,
                    "spaces": 5
                },
                "1679500800000": {
                    "available": true,
                    "spaces": 5
                },
                "1679587200000": {
                    "available": true,
                    "spaces": 5
                },
                "1679673600000": {
                    "available": true,
                    "spaces": 5
                },
                "1679760000000": {
                    "available": true,
                    "spaces": 5
                },
                "1679846400000": {
                    "available": true,
                    "spaces": 5
                },
                "1679932800000": {
                    "available": true,
                    "spaces": 5
                },
                "1680019200000": {
                    "available": true,
                    "spaces": 5
                },
                "1680105600000": {
                    "available": true,
                    "spaces": 5
                },
                "1680192000000": {
                    "available": true,
                    "spaces": 5
                },
            }
        },
        "4": {
            "available": true,
            "dates": {
                "1680278400000": {
                    "available": true,
                    "spaces": 5
                },
                "1680364800000": {
                    "available": true,
                    "spaces": 5
                },
                "1680451200000": {
                    "available": true,
                    "spaces": 5
                },
                "1680537600000": {
                    "available": true,
                    "spaces": 5
                },
                "1680624000000": {
                    "available": true,
                    "spaces": 5
                },
                "1680710400000": {
                    "available": true,
                    "spaces": 5
                },
                "1680796800000": {
                    "available": true,
                    "spaces": 5
                },
                "1680883200000": {
                    "available": true,
                    "spaces": 5
                },
                "1680969600000": {
                    "available": true,
                    "spaces": 5
                },
                "1681056000000": {
                    "available": true,
                    "spaces": 5
                },
                "1681142400000": {
                    "available": true,
                    "spaces": 5
                },
                "1681228800000": {
                    "available": true,
                    "spaces": 5
                },
                "1681315200000": {
                    "available": true,
                    "spaces": 5
                },
                "1681401600000": {
                    "available": true,
                    "spaces": 5
                },
                "1681488000000": {
                    "available": true,
                    "spaces": 5
                },
                "1681574400000": {
                    "available": true,
                    "spaces": 5
                },
                "1681660800000": {
                    "available": true,
                    "spaces": 5
                },
                "1681747200000": {
                    "available": true,
                    "spaces": 5
                },
                "1681833600000": {
                    "available": true,
                    "spaces": 5
                },
                "1681920000000": {
                    "available": true,
                    "spaces": 5
                },
                "1682006400000": {
                    "available": true,
                    "spaces": 5
                },
                "1682092800000": {
                    "available": true,
                    "spaces": 5
                },
                "1682179200000": {
                    "available": true,
                    "spaces": 5
                },
                "1682265600000": {
                    "available": true,
                    "spaces": 5
                },
                "1682352000000": {
                    "available": true,
                    "spaces": 5
                },
                "1682438400000": {
                    "available": true,
                    "spaces": 5
                },
                "1682524800000": {
                    "available": true,
                    "spaces": 5
                },
                "1682611200000": {
                    "available": true,
                    "spaces": 5
                },
                "1682697600000": {
                    "available": true,
                    "spaces": 5
                },
                "1682784000000": {
                    "available": true,
                    "spaces": 5
                },

            }
        }
    }
}];

function getCalendar(query) {
    let queryYear = query['year'];
    let queryMonth = query['month'];
    let result = {};

    //確認"年份"是否在資料庫
    let item = data.find(({
        year
    }) => {
        return year === queryYear;
    })

    if (item !== undefined) {
        //確認"月份"是否在資料庫     
        if (item['months'].hasOwnProperty(queryMonth) === true) {
            result = item['months'][queryMonth];
            result["month"] = queryMonth;
            result["year"] = queryYear;
        } else {
            //該月份未建檔
            result["msg"] = "該月份未開放，請聯繫管理人員。";
        }
    } else {
        //該年份未建檔
        result["msg"] = "該月份未開放，請聯繫管理人員。";
    }

    return result;
}

function availableLock(date) {
    let bookingYear = new Date(parseInt(date)).getFullYear().toString();
    let bookingMonth = (new Date(parseInt(date)).getMonth() + 1).toString();
    let bookingDate = date;

    let item = data.find(({
        year
    }) => {
        return year = bookingYear
    })

    let isSuccess = false;

    if (item['months'].hasOwnProperty(bookingMonth) === true) {
        if (item['months'][bookingMonth]['available'] === true && item['months'][bookingMonth]['dates'].hasOwnProperty(bookingDate) === true) {
            if (item['months'][bookingMonth]['dates'][bookingDate]['available'] === true && item['months'][bookingMonth]['dates'][bookingDate]['spaces'] > 0) {
                item['months'][bookingMonth]['dates'][bookingDate]['spaces'] -= 1;
                isSuccess = true;
            }
        }
    }

    return isSuccess;
}

function availableRelease(date) {
    console.log("release available");
    let bookingYear = new Date(parseInt(date)).getFullYear().toString();
    let bookingMonth = (new Date(parseInt(date)).getMonth() + 1).toString();
    let bookingDate = date;

    let item = data.find(({
        year
    }) => {
        return year = bookingYear
    })

    let isSuccess = false;

    item['months'][bookingMonth]['dates'][bookingDate]['spaces'] += 1;
    isSuccess = true;

    return isSuccess
}

function updateAvailable(newCalendar) {
    let result = {};

    //確認"年份"是否在資料庫
    let item = data.find(({
        year
    }) => {
        return year === newCalendar['year'];
    })

    if (item !== undefined) {
        //確認"月份"是否在資料庫     
        if (item['months'].hasOwnProperty(newCalendar['month']) === true) {
            if (item['months'][newCalendar['month']]['available'] === true) {
                Object.keys(newCalendar['dates']).forEach((key) => {
                    item['months'][newCalendar['month']]['dates'][key]['spaces'] = newCalendar['dates'][key];
                });

                result = item['months'][newCalendar['month']];
                result["month"] = newCalendar['month'];
                result["year"] = newCalendar['year'];
            } else {
                //該月份未開放
                result["msg"] = "該月份未開放，請聯繫管理人員。";
            }
        } else {
            //該月份未建檔
            result["msg"] = "無此月份資料，請聯繫管理人員。";
        }
    } else {
        //該年份未建檔
        result["msg"] = "無此年份資料，請聯繫管理人員。";
    }

    return result;
}

module.exports = {
    getCalendar,
    availableLock,
    availableRelease,
    updateAvailable,
    data
};